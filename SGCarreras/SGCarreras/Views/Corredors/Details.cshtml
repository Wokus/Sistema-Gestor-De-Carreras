@model SGCarreras.Models.Corredor
@using static SGCarreras.Models.Estado;
@{
    ViewData["Title"] = "Details";
    string filtro = ViewBag.FiltroActual as string ?? "Todas";
    var listaRegistros = Model.registros;
}

<h1>Details</h1>

<div>
    <h4>Corredor</h4>
    <hr />
    <dl class="row">
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Sexo)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Sexo)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.NombreCompleto)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.NombreCompleto)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Cedula)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Cedula)
        </dd>
    </dl>
    <div class="container mt-4">
        <h2 class="mb-4 text-center fw-bold text-primary">Calendario</h2>

        <div class="btn-group mb-4 d-flex justify-content-center" role="group" aria-label="Filtros de carreras">
            <a class="btn btn-outline-primary @(filtro == "Todas" ? "active" : "")" asp-action="Details" asp-route-filtro="Todas">Todas</a>
            <a class="btn btn-outline-primary @(filtro == "Activas" ? "active" : "")" asp-action="Details" asp-route-filtro="Activas">Activas</a>
            <a class="btn btn-outline-primary @(filtro == "EnEspera" ? "active" : "")" asp-action="Details" asp-route-filtro="EnEspera">En Espera</a>
            <a class="btn btn-outline-primary @(filtro == "Finalizadas" ? "active" : "")" asp-action="Details" asp-route-filtro="Finalizadas">Finalizadas</a>
        </div>

        <div class="table-responsive shadow rounded">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Nombre</th>
                        <th>Ubicación</th>
                        <th>Kilómetros Totales</th>
                        <th>Fecha y Hora</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in listaRegistros)
                    {
                        <tr>
                            @if (
                                (item.Carrera.Estado == EstadoEnum.Activo && filtro == "Activas") ||
                                (item.Carrera.Estado == EstadoEnum.En_espera && filtro == "EnEspera") ||
                                (item.Carrera.Estado == EstadoEnum.Finalizada && filtro == "Finalizadas") ||
                                (filtro == "Todas")
                            )
                            {
                            <td class="fw-semibold">@item.Carrera.Nombre</td>
                            <td>@item.Carrera.Ubicacion</td>
                            <td>@string.Format("{0:N2}", item.Carrera.KmTotales)</td>
                            <td>@item.Carrera.Fecha.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>
                                <span class="badge @GetEstadoBadgeClass(item.Carrera.Estado)">
                                    @item.Carrera.Estado.ToString()
                                </span>
                            </td>
                            <td>
                                    <a asp-controller="Carreras" asp-action="Details" asp-route-id="@item.Carrera.Id" class="btn btn-sm btn-info">Ver Detalles</a>
                            </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    @functions {
        private string GetEstadoBadgeClass(SGCarreras.Models.Estado.EstadoEnum estado)
        {
            return estado switch
            {
                SGCarreras.Models.Estado.EstadoEnum.Activo => "bg-success",
                SGCarreras.Models.Estado.EstadoEnum.En_espera => "bg-warning text-dark",
                SGCarreras.Models.Estado.EstadoEnum.Finalizada => "bg-secondary",
                _ => "bg-light text-dark"
            };
        }
    }




</div>
<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>

